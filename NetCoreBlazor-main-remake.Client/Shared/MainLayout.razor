@inherits LayoutComponentBase
@inject NetCoreBlazor_main_remake.Client.Services.AuthService AuthService
@inject NavigationManager Navigation

<div class="layout">
    <nav class="sidebar" style="@(!isLoggedIn ? "display:none" : "")">
        <h3>Panel Culinario</h3>
        <ul>
            <li><NavLink href="/home" class="nav-link" activeclassname="active">Home</NavLink></li>
            <li><NavLink href="/usuarios" class="nav-link" activeclassname="active">Usuarios</NavLink></li>
            <li><NavLink href="/recetas" class="nav-link" activeclassname="active">Recetas</NavLink></li>
            <li><NavLink href="/ingredientes" class="nav-link" activeclassname="active">Ingredientes</NavLink></li>
        </ul>
        <button @onclick="Logout" class="logout-button">Cerrar sesi√≥n</button>
    </nav>
    <main class="content">
        @Body
    </main>
</div>

@code {
    private bool isLoggedIn = false;

    protected override async Task OnInitializedAsync()
    {
        isLoggedIn = await AuthService.IsLoggedInAsync();
        AuthService.OnChange += AuthStateChanged;
    }

    private async Task AuthStateChanged()
    {
        isLoggedIn = await AuthService.IsLoggedInAsync();
        await InvokeAsync(StateHasChanged);
    }

    private async Task Logout()
    {
        await AuthService.LogoutAsync();
        Navigation.NavigateTo("/");
    }

    public void Dispose()
    {
        AuthService.OnChange -= AuthStateChanged;
    }
}
